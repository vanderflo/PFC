<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<link rel="stylesheet" type="text/css" media="all" href="style.css" />
	<script type="text/javascript" src="jquery-1.8.2.js"></script>
	<title>Reading XML with jQuery</title>
     <script>
     	$(document).ready(function(){
     		//Llamada AJAX para recuperar los proyectos actuales.
     		$.ajax({
				type: "GET",
				url: "http://localhost:8080/PFC/rest/API/projects",
				dataType: "xml",
				success: function(xml) {
					
					$(xml).find('project').each(function(){		
						
						var status;
						var title;
						var id;
						
						$(this).find('title').each(function(){
						title = $(this).text();
						});
						
						$(this).find('id').each(function(){
						id = $(this).text();
						});
						
						$(this).find('status').each(function(){
						status = $(this).text();
						});
						
						$('#projects').append('<h3><a id="linktest" projectid="'+id+'" href="#">' + title + '- Status '+status+'</a></h3>');
						
						
						
					});
				}
			});//END Llamada AJAX
     		
     		//TEST
			  $("#linktest").live("click",function() {
				  alert("Hola");
				  var id = $(this).attr('projectid');
				  
				  $.ajax({
						type: "GET",
						url: "http://localhost:8080/PFC/rest/API/project/"+id,
						dataType: "xml",
						success: function(xml) {
							
							$(xml).find('idCoordinator').each(function(){
							var coordId=$(this).text();
							$('#project').append('<h5>Coordinator: ' + coordId + '</h5>');
							});
							
							$(xml).find('workpackage').each(function(){
								var wpTitle=$(this).attr("title");
								$(this).find('member').each(function(){
									var member = $(this).text();
									$('#project').append('<h6>Member name: ' + member + '</h6>');
									});
								$(this).find('email').each(function(){
									var email = $(this).text();
									$('#project').append('<h6>Email: ' + email + '</h6>');
									});
								$(this).find('task').each(function(){
									var taskTitle=$(this).attr("title");
									$('#project').append('<h5>Task: ' + taskTitle + '</h5>');
										$(this).find('description').each(function(){
										var taskDesc=$(this).text();
										$('#project').append('<h6>' + taskDesc + '</h6>');
										});
									});
							});
							
						}		
							
						
					});//end Ajax
				  
			      return false;
			   });
     		
     		//END TEST
     		
     		
		});
     </script>
</head>
<body>
	<div id="page-wrap">
     	<h1>Current projects</h1>
     </div>
     	<div id="projects">
     	
     </div> 
     
     <div id="project">
     	
     </div> 
     
   

</body>
</html>