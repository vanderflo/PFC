<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<link rel="stylesheet" type="text/css" href="css/style.css" />
	<script type="text/javascript" src="jquery-1.8.2.js"></script>
	<title>Reading XML with jQuery</title>
     <script>
     	$(document).ready(function(){
     		$.getScript("projects.js");
     		
			$('#nav > li > a').live("click",function() {
			    if ($(this).attr('class') != 'active'){
			      $('#nav li ul').slideUp();
			      $(this).next().slideToggle();
			      $('#nav li a').removeClass('active');
			      $(this).addClass('active');
			    }else{			    			      
				      $(this).removeClass('active');
				      $(this).next().slideUp();
				    }
			    
			  });
			
			
     		//Mostrar proyecto
			  $("#projectButton").live("click",function() {
		     	$('#projectForm').hide();
		     	$('#wp').hide();
		     	$('#task').hide();
		     	$('#project').empty();
				$('#project').show();
				  var id = $(this).attr('projectid');				 
				  $.ajax({
						type: "GET",
						url: "http://localhost:8080/PFC/rest/API/project/"+id,
						dataType: "xml",
						success: function(xml) {
							var projectTitle;
							var formHtml="";
							$(xml).find('metainfo').each(function(){
								projectTitle= $(this).children('title').text();
								formHtml='<ul id="nav"><li><a href="#">'+ projectTitle + '</a></li>';
								$(this).find('partner').each(function(){
								var coordId=$(this).attr("id");
								var coordName= $(this).children('name').text();								
								formHtml=formHtml+'<li><a href="#">'+ coordName + '</a></li>';
								});
							});
							$(xml).find('workpackage').each(function(){
								
								var wpTitle=$(this).attr("title");
								var wpId=$(this).attr("id");
								formHtml=formHtml+'<li><a href="#">'+ wpTitle + '</a><ul>';
								
								
								
								$(this).find('task').each(function(){
									var taskTitle=$(this).attr("title");
									formHtml=formHtml+'<li><a href="#">'+ taskTitle + '</a></li>';
										
										$(this).find('description').each(function(){
										var taskDesc=$(this).text();
										formHtml=formHtml+'<li><a href="#">'+ taskDesc + '</a></li>';
										});
										// $(this).find('partner').each(function(){
										//$(this).find('member').each(function(){
											//var member = $(this).text();
											//$('#project').append('<h6>Member name: ' + member + '</h6>');
											//});										
										//$(this).find('email').each(function(){
											//var email = $(this).text();
											//$('#project').append('<h6>Email: ' + email + '</h6>');
											//});
									//});
								});
								formHtml=formHtml+'<li><a id="createTask" projectId='+id+' wpId='+wpId+' href="#">ADD NEW TASK</a></li>';
								formHtml=formHtml+'</ul>';
							});//workpackage							
							formHtml=formHtml+'<li><a id="createWp" projectId='+id+' href="#">ADD NEW WP TO PROJECT</a></li>';
							$('#project').append(formHtml);

						}		
							
						
					});//end Ajax
				  
			      return false;
			   });
     		
     		//END Mostrar proyecto
     		
     		//Show new Proyect form
  			$("#createProyect").live("click",function() {
  				$('#wp').hide();
  				$('#task').hide();
		        $('#projectForm').find("input[type=text], textarea").val("");
  				$('#projectForm').show();
	  		});
     		//END new proyect form
     		
     		//Show new Task form
  			$("#createTask").live("click",function() {  				
  				$('#project').hide();
  				$('#wp').hide();
  				$('#task').find("input[type=text], textarea").val("");
  				$('#task').show();
  				var prId = $(this).attr('projectId');
  				var wpId = $(this).attr('wpId');
  				$('#task').find("input[name='prId']").val(prId);
  				$('#task').find("input[name='wpId']").val(wpId);
  			});
     		//END new proyect form
     		
     		//Show new WP form
  			$("#createWp").live("click",function() {
  				$('#project').hide();
  				$('#task').hide();
  				$('#wp').find("input[type=text], textarea").val("");
  				$('#wp').show();
  				var prId = $(this).attr('projectId');
  				$('#wp').find("input[type=hidden]").val(prId);
  				
  				
  			});
     		//END new proyect form
     		
     		
			//Send info new proyect
     		$("#createProyectForm").submit(function(event){
    		// setup some local variables
    		var $form = $(this),
        	// let's select and cache all the fields
        	$inputs = $form.find("title, dateStart, dateFinish, desc"),
        	// serialize the data in the form
        	serializedData = $form.serialize();

		    // let's disable the inputs for the duration of the ajax request
		    $inputs.attr("disabled", "disabled");

   			 // fire off the request to REST URL
		    $.ajax({
		        url: "http://localhost:8080/PFC/rest/API/create/project/",
		        type: "post",
		        data: serializedData,
		        // callback handler that will be called on success
		        success: function(response, textStatus, jqXHR){
		            // log a message to the console
		        console.log("Hooray, it worked!");	        
		        $('#project').empty();
  				$('#wp').find("input[type=text], textarea").val("");
  				$('#wp').show();
		        },
		        // callback handler that will be called on error
		        error: function(jqXHR, textStatus, errorThrown){
		            // log the error to the console
		            console.log(
		                "The following error occured: "+
		                textStatus, errorThrown
		            );
		        },
		        // callback handler that will be called on completion
		        // which means, either on success or error
		        complete: function(){
		            // enable the inputs
		            $inputs.removeAttr("disabled");
		        }
		    });
		
		    // prevent default posting of form
		    event.preventDefault();
		});//END send Info
		
		
		
		//Send info new WP
		$("#createWpForm").live("submit",function() {
			var $form = $(this),
        	$inputs = $form.find("title, wpDateStart, wpDateFinish, effort,coordinator"),
        	serializedData = $form.serialize();	
			var prId = $("#createWpForm :input[name='prId']").val();
		    $inputs.attr("disabled", "disabled");
			$.ajax({				
				url: "http://localhost:8080/PFC/rest/API/add/WP/"+prId,
				type: "post",
		        data: serializedData,
		        // callback handler that will be called on success
		        success: function(response, textStatus, jqXHR){
		            // log a message to the console
		        console.log("Hooray, WP created!");   
		        },
		        // callback handler that will be called on error
		        error: function(jqXHR, textStatus, errorThrown){
		            // log the error to the console
		            console.log(
		                "The following error occured: "+
		                textStatus, errorThrown
		            );
		        },
		        // callback handler that will be called on completion
		        // which means, either on success or error
		        complete: function(){
		            // enable the inputs
		          $inputs.removeAttr("disabled");
		        }
		    });		
		    // prevent default posting of form
		    event.preventDefault();
		});//END send WP
 		
 		
		//Send info new Task
		$("#createTaskForm").live("submit",function() {
			var $form = $(this),
        	$inputs = $form.find("taskTitle, taskDateStart, taskDateFinish, taskEffort,taskDescription,taskPartners"),
        	serializedData = $form.serialize();	
			var prId = $("#createTaskForm :input[name='prId']").val();
			var wpId = $("#createTaskForm :input[name='wpId']").val();
		    $inputs.attr("disabled", "disabled");
			$.ajax({				
				url: "http://localhost:8080/PFC/rest/API/add/task/"+prId+"/"+wpId,
				type: "post",
		        data: serializedData,
		        // callback handler that will be called on success
		        success: function(response, textStatus, jqXHR){
		            // log a message to the console
		        console.log("Hooray, WP created!");   
		        },
		        // callback handler that will be called on error
		        error: function(jqXHR, textStatus, errorThrown){
		            // log the error to the console
		            console.log(
		                "The following error occured: "+
		                textStatus, errorThrown
		            );
		        },
		        // callback handler that will be called on completion
		        // which means, either on success or error
		        complete: function(){
		            // enable the inputs
		          $inputs.removeAttr("disabled");
		        }
		    });		
		    // prevent default posting of form
		    event.preventDefault();
		});//END send task
     });
     	
     </script>
</head>
<body>     
     
     <header>
		<h1>Partner Menu</h1>
	</header>

	<aside id="projects">
	</aside>
	
<section>
		
<article id="project">
</article>		

<article id="projectForm">
	<h2>Create new project</h2>
	<form action="#" id="createProyectForm" method="post">
		<fieldset>
			<label for="title">Title:</label>
			<input type="text" id="title" name="title" placeholder="PROJECT TITLE" />
			
			<label for="dateStart">Start Date:</label>
			<input type="text" id="dateStart" name="dateStart" placeholder="DATE" />
			
			<label for="dateFinish">Finish Date:</label>
			<input type="text" id="dateFinish" name="dateFinish" placeholder="DATE" />
			
			<label for="desc">Description:</label>
			<textarea id="desc" name="desc" placeholder="Brief description of the project"></textarea>
			<label for="submit"></label>			
			<input type="submit" id="submit" value="Create Project" />
			
		</fieldset>
	</form>
</article>

<article id="wp">
	<h2>Create WP</h2>
	<form action="#" id="createWpForm" method="post">
		<fieldset id="newWP">
			<label for="title">Title:</label>
			<input type="text" id="title" name="title" placeholder="WORKPACKAGE TITLE" />
			
			<label for="title">Coordinator:</label>
			<input type="text" id="coordinator" name="coordinator" placeholder="COORDINATOR" />
			
			<label for="effort">Effort:</label>
			<input type="text" id="effort" name="effort" placeholder="EFFORT" />
			
			<label for="wpDateStart">Start Date:</label>
			<input type="text" id="wpDateStart" name="wpDateStart" placeholder="DATE" />
			
			<label for="wpDateFinish">Finish Date:</label>
			<input type="text" id="wpDateFinish" name="wpDateFinish" placeholder="DATE" />
			
			<label for="submit"></label>			
			<input type="submit" id="submit" value="SAVE AND CREATE WP" />
			
			<label for="prId"></label>
			<input type="hidden" id="prId" name="prId" />
			
			</fieldset>
	</form>
</article>

<article id="task">
	<h2>Create Task</h2>
	<form action="#" id="createTaskForm" method="post">
		<fieldset id="newTask">
			<label for="taskTitle">Task:</label>
			<input type="text" id="taskTitle" name="taskTitle" placeholder="TASK TITLE" />
			
			<label for="taskDateStart">Start Date:</label>
			<input type="text" id="taskDateStart" name="taskDateStart" placeholder="DATE" />
			
			<label for="taskDateFinish">Finish Date:</label>
			<input type="text" id="taskDateFinish" name="taskDateFinish" placeholder="DATE" />
			
			<label for="taskEffort">Effort:</label>
			<input type="text" id="taskEffort" name="taskEffort" placeholder="DATE" />
			
			<label for="taskPartners">Partners:</label>
			<input type="text" id="taskPartners" name="taskPartners" placeholder="DATE" />
			
			<label for="taskDescription">Description:</label>
			<textarea id="taskDescription" name="taskDescription" placeholder="Brief description of the task"></textarea>
			
			<label for="submitTask"></label>			
			<input type="submit" id="submitTask" value="SAVE AND CREATE TASK" />
			
			<label for="wpId"></label>
			<input type="hidden" id="wpId" name="wpId" />
			
			<label for="prId"></label>
			<input type="hidden" id="prId" name="prId" />
			
			</fieldset>
	</form>
</article>
			
</section>
	
	
	
	
	<footer>
		
	</footer>
   

</body>
</html>