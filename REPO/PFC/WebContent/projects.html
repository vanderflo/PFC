<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<link rel="stylesheet" type="text/css" href="css/style.css" />
	<script type="text/javascript" src="jquery-1.8.2.js"></script>
	<title>Reading XML with jQuery</title>
     <script>
     	$(document).ready(function(){
     		$('#project').hide();
     		$('#wp').hide();
     		$('#task').hide();
     		//Llamada AJAX para recuperar los proyectos actuales.
     		$.ajax({
				type: "GET",
				url: "http://localhost:8080/PFC/rest/API/projects",
				dataType: "xml",
				success: function(xml) {
					
					$(xml).find('project').each(function(){		
						
						var status;
						var title;
						var id;
						
						$(this).find('title').each(function(){
						title = $(this).text();
						});
						
						id=$(this).attr("id");
						
						$(this).find('status').each(function(){
						status = $(this).text();
						});
						
						$('#projects').append('<h3><a id="projectButton" class="projectButton" projectid="'+id+'" href="#">' + title + '- Status '+status+'</a></h3>');
						
						
						
					});
					$('#projects').append('<h3><a id="createProyect" class="projectButton" href="#">NEW PROJECT</a></h3>');
					$('#projects').append('<h3><a id="createWp" class="projectButton" href="#">NEW WP</a></h3>');
					$('#projects').append('<h3><a id="createTask" class="projectButton" href="#">NEW TASK</a></h3>');
				}
			});//END Llamada AJAX
     		
     		//Mostrar proyecto
			  $("#projectButton").live("click",function() {
				  $('#project').hide();
				  var id = $(this).attr('projectid');
				  $('#project').empty();
				  $.ajax({
						type: "GET",
						url: "http://localhost:8080/PFC/rest/API/project/"+id,
						dataType: "xml",
						success: function(xml) {
							
							$(xml).find('metainfo').each(function(){								
								$('#project').append('<h4>Project: ' + $(this).children('title').text() + '</h4>');
								$(this).find('partner').each(function(){
								var coordId=$(this).attr("id");
								var coordName= $(this).children('name').text();
								$('#project').append('<h5>Coordinator: ' + coordName + '('+coordId+')</h5>');
								});
							});
							
							$(xml).find('workpackage').each(function(){
								var wpTitle=$(this).attr("title");
								$('#project').append('<h6>WP: ' + wpTitle + '</h6>');
								
								$(this).find('task').each(function(){
									var taskTitle=$(this).attr("title");
									$('#project').append('<h5>Task: ' + taskTitle + '</h5>');
										
										$(this).find('description').each(function(){
										var taskDesc=$(this).text();
										$('#project').append('<h6>' + taskDesc + '</h6>');
										});
										$(this).find('partner').each(function(){
										$(this).find('member').each(function(){
											var member = $(this).text();
											$('#project').append('<h6>Member name: ' + member + '</h6>');
											});										
										$(this).find('email').each(function(){
											var email = $(this).text();
											$('#project').append('<h6>Email: ' + email + '</h6>');
											});
									});
								});
							});//workpackage
						}		
							
						
					});//end Ajax
				  
			      return false;
			   });
     		
     		//END Mostrar proyecto
     		
     		//Show new Proyect form
  			$("#createProyect").live("click",function() {
  				$('#wp').hide();
  				$('#task').hide();
		        $('#project').find("input[type=text], textarea").val("");
  				$('#project').show();
	  		});
     		//END new proyect form
     		
     		//Show new Task form
  			$("#createTask").live("click",function() {  				
  				$('#project').hide();
  				$('#wp').hide();
  				$('#task').find("input[type=text], textarea").val("");
  				$('#task').show();
  			});
     		//END new proyect form
     		
     		//Show new WP form
  			$("#createWp").live("click",function() {
  				$('#project').hide();
  				$('#task').hide();
  				$('#wp').find("input[type=text], textarea").val("");
  				$('#wp').show();
  			});
     		//END new proyect form
     		
     		
			//Send info new proyect
     		$("#createProyectForm").submit(function(event){
    		// setup some local variables
    		var $form = $(this),
        	// let's select and cache all the fields
        	$inputs = $form.find("title, dateStart, dateFinish, desc"),
        	// serialize the data in the form
        	serializedData = $form.serialize();

		    // let's disable the inputs for the duration of the ajax request
		    $inputs.attr("disabled", "disabled");

   			 // fire off the request to REST URL
		    $.ajax({
		        url: "http://localhost:8080/PFC/rest/API/create/project/",
		        type: "post",
		        data: serializedData,
		        // callback handler that will be called on success
		        success: function(response, textStatus, jqXHR){
		            // log a message to the console
		        console.log("Hooray, it worked!");	        
		        $('#project').empty();
  				$('#wp').find("input[type=text], textarea").val("");
  				$('#wp').show();
		        },
		        // callback handler that will be called on error
		        error: function(jqXHR, textStatus, errorThrown){
		            // log the error to the console
		            console.log(
		                "The following error occured: "+
		                textStatus, errorThrown
		            );
		        },
		        // callback handler that will be called on completion
		        // which means, either on success or error
		        complete: function(){
		            // enable the inputs
		            $inputs.removeAttr("disabled");
		        }
		    });
		
		    // prevent default posting of form
		    event.preventDefault();
		});//END send Info
		
		
		
		//Send info new WP
		$("#createWpForm").live("submit",function() {
 			//Recoger parámetros y enviarlos a createWP, incluyendo el projectId 			
 		});//END send new WP
 		
 		
		//Send info new Task
		$("#createTaskForm").live("submit",function() {
 			//Recoger parámetros y enviarlos a createTask, incluyendo el projectId y el WpId			
 		});//END send new Task
     		
     		
		});
     </script>
</head>
<body>     
     
     <header>
		<h1>Administrator Menu</h1>
	</header>

	<aside id="projects">
	</aside>
	
	<section>
		
		
<article id="project">
	<h2>Create new project</h2>
	<form action="#" id="createProyectForm" method="post">
		<fieldset>
			<label for="title">Title:</label>
			<input type="text" id="title" name="title" placeholder="PROJECT TITLE" />
			
			<label for="dateStart">Start Date:</label>
			<input type="text" id="dateStart" name="dateStart" placeholder="DATE" />
			
			<label for="dateFinish">Finish Date:</label>
			<input type="text" id="dateFinish" name="dateFinish" placeholder="DATE" />
			
			<label for="desc">Description:</label>
			<textarea id="desc" name="desc" placeholder="Brief description of the project"></textarea>
			<label for="submit"></label>			
			<input type="submit" id="submit" value="Create Project" />
			
		</fieldset>
	</form>
</article>

<article id="wp">
	<h2>Create WP</h2>
	<form action="#" id="createWpForm" method="post">
		<fieldset id="newWP">
			<label for="title">Title:</label>
			<input type="text" id="title" name="title" placeholder="WORKPACKAGE TITLE" />
			
			<label for="title">Coordinator:</label>
			<input type="text" id="coordinator" name="coordinator" placeholder="COORDINATOR" />
			
			<label for="effort">Effort:</label>
			<input type="text" id="effort" name="effort" placeholder="EFFORT" />
			
			<label for="wpDateStart">Start Date:</label>
			<input type="text" id="wpDateStart" name="wpDateStart" placeholder="DATE" />
			
			<label for="wpDateFinish">Finish Date:</label>
			<input type="text" id="wpDateFinish" name="wpDateFinish" placeholder="DATE" />
			
			<label for="submitWp"></label>			
			<input type="submit" id="submitWp" value="SAVE AND CREATE WP" />
			
			<label for="hidden"></label>
			<input type="hidden" id="hidden" name="hidden" />
			
			</fieldset>
	</form>
</article>

<article id="task">
	<h2>Create Task</h2>
	<form action="#" id="createTaskForm" method="post">
		<fieldset id="newTask">
			<label for="taskTitle">Task:</label>
			<input type="text" id="taskTitle" name="taskTitle" placeholder="TASK TITLE" />
			
			<label for="taskDateStart">Start Date:</label>
			<input type="text" id="taskDateStart" name="taskDateStart" placeholder="DATE" />
			
			<label for="taskDateFinish">Finish Date:</label>
			<input type="text" id="taskDateFinish" name="taskDateFinish" placeholder="DATE" />
			
			<label for="taskDesc">Description:</label>
			<textarea id="desc" name="taskDesc" placeholder="Brief description of the task"></textarea>
			
			<label for="submitTask"></label>			
			<input type="submit" id="submitTask" value="SAVE AND CREATE TASK" />
			
			<label for="hidden"></label>
			<input type="hidden" id="hidden" name="hidden" />
			
			</fieldset>
	</form>
</article>
			
</section>
	
	
	
	
	<footer>
		
	</footer>
   

</body>
</html>